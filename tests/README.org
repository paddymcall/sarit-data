#+TITLE: Notes on the sarit-data/tests things


* Setting up the database for testing

#+BEGIN_SRC bash
  #!env /bin/bash
  EXISTDIR="/opt/lib/existdb-3.0rc1"
  EXISTCOLLECTION="/db/soup"
  # files to use, using relative paths
  EXISTFILE="saritcorpus.xml"
  EXISTCONFIG="../collection.xconf"
  $EXISTDIR/bin/client.sh -u admin -P admin --no-gui --rmcol $EXISTCOLLECTION \
      && \
      $EXISTDIR/bin/client.sh -u admin -P admin --no-gui --mkcol $EXISTCOLLECTION \
      && \
      $EXISTDIR/bin/client.sh -u admin -P admin --no-gui --rmcol "/db/system/config/"$EXISTCOLLECTION \
      && \
      $EXISTDIR/bin/client.sh -u admin -P admin --no-gui --mkcol "/db/system/config/"$EXISTCOLLECTION \
      && \
      $EXISTDIR/bin/client.sh --collection "/db/system/config/"$EXISTCOLLECTION -u admin -P admin \
                              --parse $EXISTCONFIG
      && \
      $EXISTDIR/bin/client.sh --collection $EXISTCOLLECTION -u admin -P admin \
                              --parse $EXISTFILE && \

      # on my laptop: parsed 104107439 bytes in 694576ms.
    
                            
#+END_SRC


* Some tests // experiments

- these suggest you use https://github.com/pashky/restclient.el


** see if rest api is alive

 #+BEGIN_SRC restclient
   GET http://localhost:8080/exist/rest/
   User-Agent: Emacs Restclient
 #+END_SRC


** get a file 

#+BEGIN_SRC restclient
  GET http://localhost:8080/exist/rest/sarit-data/master/avayavinirakarana.xml
#+END_SRC


** get the config

#+BEGIN_SRC restclient
  GET http://localhost:8080/exist/rest/db/system/config/db/sarit-data/collection.xconf
#+END_SRC



** simple search (not working, namespace issue?)

#+BEGIN_SRC restclient
  GET http://localhost:8080/exist/rest/sarit-data/master/avayavinirakarana.xml?_query=//p
#+END_SRC


** full text query (standard index)

#+BEGIN_SRC restclient
  POST http://localhost:8080/exist/rest/sarit-data/master/avayavinirakarana.xml
  Content-Type: application/xml

  <query xmlns="http://exist.sourceforge.net/NS/exist" xmlns:tei="http://www.tei-c.org/ns/1.0">
  <text>//tei:p[ft:query(., "तत्र")]</text>
  </query>
#+END_SRC


** full text query for slp1 index

#+BEGIN_SRC restclient
  POST http://localhost:8080/exist/rest/sarit-data/master/avayavinirakarana.xml
  Content-Type: application/xml

  <query xmlns="http://exist.sourceforge.net/NS/exist" xmlns:tei="http://www.tei-c.org/ns/1.0">
  <text>//tei:p[ft:query(., "tatra")]</text>
  </query>
#+END_SRC




** full text wildcard query

#+BEGIN_SRC restclient
  POST http://localhost:8080/exist/rest/sarit-data/master/avayavinirakarana.xml
  Content-Type: application/xml

  <query xmlns="http://exist.sourceforge.net/NS/exist">
  <text>
  let $query := <query xmlns="http://exist.sourceforge.net/NS/exist"><bool><wildcard occur="must">jalārth*</wildcard></bool></query>
  //*[ft:query(., "tatra")]
  </text>       
  </query>
#+END_SRC




